delay = (cb, i) ->
   i = i || 3
   setTimeout cb, i

test = (cb) ->
  bar = (i, cb) ->
    await delay defer()
    arguments[1](arguments[0])
  await bar 10, defer x
  cb(10 is x, {})

await test defer r, x
console.log r
